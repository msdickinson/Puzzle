<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <link href="css/main.css" rel="stylesheet" />
    <link href="css/pure.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <title></title>
    <script src="script/Lib/howler/howler.js"></script>
    <script src="script/Lib/mainloop/mainloop.js"></script>
    <script src="script/Lib/pixi/pixi.js"></script>
</head>
<body>
    <div id="Group">
        <div id="Game" hidden></div>
        <div id="Loading" class="loading">
            <center>
                <div class="loader"></div>
            </center>
        </div>
        <div id="Home" hidden>
            <center>
                <h1>Puzzle</h1>
                <div onclick="SetPage('SinglePlayerLobby')" style="border-width: 3px;
                        border-style: solid;
                        margin-top: 20px;
                        padding: 10px;
                        border-radius: 25px;
                        background-color: #e7e7e7;
                        width: 300px">

                    <i class="fas fa-gamepad fa-5x"></i>

                </div>

                <div onclick="SetPage('RoomLobby')" style="border-width: 3px;
                        border-style: solid;
                        margin-top: 20px;
                        padding: 10px;
                        border-radius: 25px;
                        background-color: #e7e7e7;  width: 300px;">

                    <i class="fas fa-users fa-5x"></i>

                </div>

                <div onclick="SetPage('HowToPlay')" style="border-width: 3px;
                        border-style: solid;
                        margin-top: 20px;
                        padding: 10px;
                        border-radius: 25px;
                        background-color: #e7e7e7; width: 300px;">

                    <i class="fas fa-question fa-5x"></i>

                </div>
            </center>
            <!--<center>
                <h1>Lobby</h1>
                <div style="border-width: 3px;
                        border-style: solid;
                        margin-top: 20px;
                        padding: 10px;
                        border-radius: 25px;
                        background-color: #e7e7e7;
                        width: 300px">
                    <i class="fas fa-arrow-up fa-5x"></i>
                </div>
                <div style="border-width: 3px;
                        border-style: solid;
                        margin-top: 20px;
                        padding: 10px;
                        border-radius: 25px;
                        background-color: #e7e7e7;
                        width: 300px">
                    <i class="fas fa-arrow-down fa-5x"></i>
                </div>
                <div style="border-width: 3px;
                border-style: solid;
                margin-top: 20px;
                padding: 10px;
                border-radius: 25px;
                background-color: #e7e7e7;
                width: 400px">

                    <span style="font-size: 2.44141rem; font-weight: 500;">
                        1
                    </span>
                </div>
                <div style="border-width: 3px;
                        border-style: solid;
                        margin-top: 20px;
                        padding: 10px;
                        border-radius: 25px;
                        background-color: #e7e7e7;
                        width: 300px">
                    <i class="fas fa-play fa-5x"></i>
                </div>


            </center>-->
            <!--<center>
        <h1>Puzzle</h1>
        <div style="border-width: 3px;
                border-style: solid;
                margin-top: 20px;
                padding: 10px;
                border-radius: 25px;
                background-color: #e7e7e7;
                width: 400px">

            <i class="fas fa-gamepad fa-5x"></i>
            <span style="font-size: 2.44141rem; font-weight: 500;">
                Single Player
            </span>
        </div>

        <div style="border-width: 3px;
                border-style: solid;
                margin-top: 20px;
                padding: 10px;
                border-radius: 25px;
                background-color: #e7e7e7;  width: 400px;">

            <i class="fas fa-users fa-5x"></i>
            <span style="font-size: 2.44141rem; font-weight: 500;">
                Multiplayer
            </span>


        </div>

        <div style="border-width: 3px;
                border-style: solid;
                margin-top: 20px;
                padding: 10px;
                border-radius: 25px;
                background-color: #e7e7e7; width: 400px;">

            <i class="fas fa-question fa-5x"></i>
            <span style="font-size: 2.44141rem; font-weight: 500;">
                How To Play
            </span>
        </div>
    </center>-->
            <!--<button onclick="SetPage('SinglePlayerLobby')">Single Player </button>
    <button onclick="SetPage('HighScores')">High Scores</button>
    <h3>Battle Mode</h3>
    <button onclick="SetPage('TwoPlayerLobby')">Two Player Local</button>
    <button onclick="SetPage('RoomLobby')">Find Oppents</button>

    <h3>Misc</h3>
    <button onclick="SetPage('HowToPlay')">HowToPlay</button>-->
        </div>
        <div id="SinglePlayerLobby" hidden>
            <button onclick="SetPage('Home')">Home</button>

            <h4>Name</h4>
            <input value="" />
            <button>Update</button>

            <h4>Starting Level</h4>
            <input type="number" value="5" min="1" max="20" />

            <br />
            <button onclick="SetPage('SinglePlayerGame')">Start</button>
        </div>
        <div id="TwoPlayerLobby" hidden>
            <button onclick="SetPage('Home')">Home</button>

            <h4>Starting Level Player 1</h4>
            <input type="number" value="5" min="1" max="20" />

            <h4>Starting Level Player 2</h4>
            <input type="number" value="5" min="1" max="20" />

            <br />
            <button onclick="SetPage('TwoPlayerGame')">Start</button>
        </div>
        <div id="RoomLobby" hidden>
            <button onclick="SetPage('Home')">Home</button>

            <h4>Name</h4>
            <input value="" />            <button>Update</button>

            <h4>Players</h4>
            <ul style="list-style-type:none">
                <li>Bob</li>
                <li>Frank</li>
            </ul>

            <h4>Chat</h4>
            <ul style="list-style-type:none">
                <li>(Time) Bob: Hi</li>
                <li>(Time) Frank: Hi</li>
            </ul>
            <h4>Create Message</h4>
            <input value="" />
            <button>Send</button>

            <br />
            <button onclick="SetPage('RoomGame')">Start</button>
        </div>
        <div id="SinglePlayerGame" hidden>
            <button onclick="SetPage('SinglePlayerLobby')">Lobby</button>
            <div id="SinglePlayerGame_Game"></div>
            <div> </div>
        </div>
        <div id="TwoPlayerGame" hidden>
            <button onclick="SetPage('TwoPlayerLobby')">Lobby</button>
            <div id="TwoPlayerGame_Game"></div>
        </div>
        <div id="RoomGame" hidden>
            <button onclick="SetPage('Home')">Home</button>


            <h4>Chat</h4>
            <ul style="list-style-type:none">
                <li>(Time) Bob: Hi</li>
                <li>(Time) Frank: Hi</li>
            </ul>
            <h4>Create Message</h4>
            <input value="" />
            <button>Send</button>
        </div>
        <div id="HighScores" hidden>
            <button onclick="SetPage('Home')">Home</button>

            <h4>Top Scores</h4>
            <ul style="list-style-type:none">
                <li>Bob: 24124</li>
                <li>Frank: 1000</li>
            </ul>
        </div>
        <div id="HowToPlay" hidden>
            <button onclick="SetPage('Home')">Home</button>
            <div>            You get 3+ blocks Vertircal Or Horzzinal.</div>
            <div>            You can swap blocks left and right</div>
            <div>  You lose when blocks reach the top</div>
            <div>    On Battle mode, You need to get a set of blocks that touch the garbage and then you can remove the garbage</div>
        </div>
    </div>

    <script type="module">
        import { App } from "/script/Puzzle/App.js";

        let app;
        let ApplicationPromise = new Promise(function (resolve, reject) {
            app = new App(document, resolve);
        }.bind(this));

        ApplicationPromise.then((res) => {
            MainLoop.setUpdate(app.Tick.bind(app)).setDraw(app.UpdateView.bind(app)).start();
            document.querySelector('#Loading').hidden = true;
            document.querySelector('#Home').hidden = false;
        });

  
        window.document.SetPage = function(page){
            if (page === "SinglePlayerLobby") {
                let appModePromise = new Promise(function (resolve, reject) {
                    app.Mode("SinglePlayer", document.querySelector('#SinglePlayerGame_Game'), resolve, reject);
                }.bind(this));

                appModePromise.then(() => {
                    window.document.SetPageVis("SinglePlayerLobby");
                })
            }

            if (page === "SinglePlayerGame") {
                app.client.StartSinglePlayer(3);
                window.document.SetPageVis("SinglePlayerGame");
            }

            else if (page === "TwoPlayerLobby") {
                let appModePromise = new Promise(function (resolve, reject) {
                    app.Mode("TwoPlayer", document.querySelector('#TwoPlayerGame_Game'), resolve, reject);
                }.bind(this));

                appModePromise.then(() => {
                    app.client.StartTwoPlayer(3, 3);
                    window.document.SetPageVis("TwoPlayerLobby");
                })
            }

            else if (page === "RoomLobby") {
                window.document.SetPageVis("Loading");

                let appModePromise = new Promise(function (resolve, reject) {
                    app.Mode("Online", document.querySelector('#SinglePlayerGame_Draw'), resolve, reject);
                }.bind(this));

                appModePromise.then(() => {
                    window.document.SetPageVis("RoomLobby");
                }).catch((err) => {
                    if (app.client != null) {
                        app.client.Terminate();
                        app.client = null;
                    }
                    window.document.SetPageVis("Home");
                    window.alert("Unable to connect to server");
                });

            }

            else if (page === "Home") {
                if (app.client != null) {
                    app.client.Terminate();
                    app.client = null;
                }

                window.document.SetPageVis("Home");
            }

            else {
                window.document.SetPageVis(page);
            }

        }

        window.document.SetPageVis = function(page){
            document.querySelector('#Home').hidden = true;
            document.querySelector('#Loading').hidden = true;
            document.querySelector('#SinglePlayerLobby').hidden = true;
            document.querySelector('#TwoPlayerLobby').hidden = true;
            document.querySelector('#TwoPlayerLobby').hidden = true;
            document.querySelector('#RoomLobby').hidden = true;
            document.querySelector('#SinglePlayerGame').hidden = true;
            document.querySelector('#TwoPlayerGame').hidden = true;
            document.querySelector('#RoomGame').hidden = true;
            document.querySelector('#HighScores').hidden = true;
            document.querySelector('#HowToPlay').hidden = true;
            document.querySelector('#' + page).hidden = false;
        }

    </script>

</body>

</html>